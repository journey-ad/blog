<!DOCTYPE html>
<html lang="zh">
<!--
             -. .                                        
       _____   ',' ,                                    
     ,'     ,'   ', ',                                  
   ,'     ,'      |  |                                  
   \       \       |  |                                  
     \ /^\   \    ,' ,'                                  
           \   \ ,' ,'      L'Internationale,            
     / ~-.___\.-'  ,'            Sera le genre humain.   
   /   .______.- ~ \                                     
 /   /'          \   \                                   
 \./               \/'                                   
                                                         
-->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="/favicon.png" type="image/png">
    <title>破解Sketchfab加密并提取模型数据 - 恶魔萝莉控</title>
    
      
<link rel="stylesheet" href="/css/style.css">

      
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

      
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

      
<link rel="stylesheet" href="/libs/zpix/zpix.css">

      
<script src="/js/theme.js"></script>

    
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="恶魔萝莉控" type="application/atom+xml">
</head>

<body id="bodyx" path="archives/lab/ripping-sketchfab-models/">
    <div class="hd posts">
    <a class="back" href="javascript:void(0);" target="_self"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <h1 class="post-title">破解Sketchfab加密并提取模型数据</h1>
    <hr>

    
        <div class="outdated-notify">
            本文发布于 <span class="num">-</span> 天前，文中所描述的信息可能已发生改变或是过时，请注意辨别
        </div>
    

    <div class="post-content">
        <p><img src="https://img.imjad.cn/images/2018/11/20/record.gif" alt="魔法少女智乃"></p>

    <div class="cplayer-template"
      id="cplayer-88573290"
      data-id="cplayer-88573290"
      data-playlist=%5B%7B%22name%22%3A%22loading...%22%2C%22artist%22%3A%22loading...%22%7D%5D
      data-ids=[33955999]
      data-autoplay="false"
      style="position: relative"
    ></div>
    <script>
      (function(){

        let getLyric = id => {
          return new Promise((resolve, reject) => {
            fetch("https://hibiapi.getloli.com/api/netease/?type=lyric&id=" + id).then(res => {
              return res.json()
            }).then(data => {
              // console.log(data)
              if(!data.lrc){
                data = Object.assign(data, {
                  lrc: {lyric: '[00:00.00]找不到歌词的说…(⊙﹏⊙)[99:00.00]'},
                  tlyric: {lyric: '[00:00.00]翻译不存在的说…╮(╯▽╰)╭[99:00.00]'}
                })
              }
              let obj = {
                lyric: data.lrc.lyric,
                tlyric: data.tlyric.lyric
              }
              resolve(obj);
            })
          })
        }

        let getSrc = id => {
          return new Promise((resolve, reject) => {
            fetch("https://hibiapi.getloli.com/api/netease/?type=song&id=" + id).then(res => {
              return res.json()
            }).then(data => {
              resolve(data.data[0].url);
            })
          })
        }

        function loadcplayer() {
          if (typeof window.cplayerList === 'undefined') window.cplayerList = {};
          if (typeof window.cplayerList["cplayer-88573290"] !== 'undefined') return;
          if (!cplayer.prototype.add163) cplayer.prototype.add163 = async function add163(id) {
            if (!id) throw new Error("Unable Property.");
            let lyric = await getLyric(id);
            let src = await getSrc(id);
            // console.log(lyric)

            return fetch("https://hibiapi.getloli.com/api/netease/?type=detail&id=" + id).then(function(res){return res.json()}).then(function(data){
              let obj = {
                name: data.songs[0].name,
                artist: data.songs[0].ar.map(function(ar){ return ar.name }).join(','),
                poster: data.songs[0].al.picUrl,
                lyric: lyric.lyric,
                sublyric: lyric.tlyric,
                src: src
              }
              this.add(obj);
              return obj;
            }.bind(this))
          }

          window.cplayerList["cplayer-88573290"] = new cplayer({
            element: document.getElementById("cplayer-88573290"),
            playlist: [{"name":"loading...","artist":"loading..."}],
            generateBeforeElement: false,
            deleteElementAfterGenerate: false,
            autoplay: false,
            zoomOutKana: true,
            style: `c-player {
                      font-size: 16px !important;
                      position: relative;
                      left: 50%;
                      transform: translateX(-50%);
                      width: auto;
                      max-width: 550px;
                      margin: 30px auto;
                    }
                    c-player .cp-controls{
                      user-select: none;
                    }
                    c-player .cp-lyric{
                      width: 100%;
                      margin: 0.41667em 0;
                    }
                    c-player .cp-play-button .cp-play-icon.cp-play-icon-paused {
                      margin-left: 0.8em;
                    }
                    c-player .cp-drop-down-menu {
                      line-height: 1.85;
                    }
                    @media (max-width: 768px) {
                      c-player{
                        font-size: 12px !important;
                        left: auto;
                        transform: none;
                        width: 100%;
                        margin: 10px auto;
                      }
                      c-player .cp-mainbody{
                        min-height: 5.16667em;
                      }
                      c-player .cp-poster{
                        width: 5.16667em;
                        height: 5.16667em;
                      }
                      c-player .cp-center-container{
                        height: 5.16667em;
                      }
                      c-player .cp-play-button, c-player .cp-volume-button, c-player .cp-prev-button, c-player .cp-list-button, c-player .cp-mode-button, c-player .cp-next-button{
                        width: 1.54167em;
                        height: 1.54167em;
                      }
                      c-player .cp-icon, c-player .cp-prev-icon, c-player .cp-next-icon, c-player .cp-volume-icon, c-player .cp-random-icon, c-player .cp-single-icon, c-player .cp-loop-icon, c-player .cp-list-icon{
                        height: 1.54167em;
                        width: 1.54167em;
                      }
                      c-player .cp-play-button{
                        height: 2.8em;
                        width: 2.8em;
                      }
                      c-player .cp-play-button .cp-play-icon{
                        margin: 0.8em;
                      }
                      c-player .cp-play-button .cp-play-icon.cp-play-icon-paused {
                        margin: 0.7875em;
                        margin-left: 1em;
                      }
                      c-player .cp-volume-icon {
                        width: 1.76667em;
                      }
                      c-player .cp-list-button {
                        width: 1.54167em;
                        height: 1.54167em;
                      }
                      c-player .cp-mode-button {
                        width: 1.54167em;
                        height: 1.54167em;
                      }
                    }
                    `
          });

          window.cplayerList["cplayer-88573290"].add163(33955999)

          let player = window.cplayerList["cplayer-88573290"]
          player.to(1)
          player.remove(player.playlist[0])
        }
        
        if (typeof window.cplayer === 'undefined' && !document.getElementById("cplayer-script")) {
          var js = document.createElement("script");
          js.src = 'https://cdn.jsdelivr.net/gh/MoePlayer/cPlayer/dist/cplayer.js';
          js.id = "cplayer-script";
          js.addEventListener("load", loadcplayer);
          document.body.appendChild(js);
        } else {
          window.addEventListener("load", loadcplayer);
        }
      })()
    </script>

<h2>前言</h2><blockquote>
<p>需要说明的是，折腾仅限用于学习用途，可通过正规途径购买的模型请勿非法提取，请勿对模型及贴图等数据进行修改、二次分发、商用等违反Sketchfab版权规定及著作权相关法律法规的行为。使用本文提到的方法提取模型产生的一切后果由操作人承担，与本网站及本人无关</p>
</blockquote>
<p>最近在Sketchfab看到了一个<a href="https://sketchfab.com/models/9120703a4aee4c2cb0313a9ca3e1e1a3" target="_blank" rel="noopener">智乃的模型</a>，顿时感觉想要拥有，但模型作者并没有开放下载和购买，迫于实在是心痒难耐，便在网上寻找破解Sketchfab加密的方法</p>
<p>首先在某宝上搜索，发现有几家店铺提供了收费下载服务，虽然没有明说，但看描述信息可以实现“任意下载”，心中底气又足了两分<del>某宝下载服务均价20 RMB，希望不要因为砸了别人饭碗而被追杀🌝</del></p>
<p>网络上的资料不多，零星几个提到的信息指向了Ninja Ripper。这一工具原理是劫持系统DirectX接口，直接从内存中拿到渲染数据，理论上可以支持任意D3D应用，并且无视任何加密，毕竟不管怎么加密，最后系统喂给显卡的都是标准的数据。可惜的是Sketchfab在几个月前已经升级了系统，提取出来的都是一些残片，没有使用价值</p>
<p>抱着不死心的想法继续搜索，终于在一个毛子论坛上找到了希望：一个解密脚本。这个工具的原理就很直接了，因为Sketchfab使用了WebGL来显示模型，那么理论上就一定能够破解，毕竟加解密算法都在前端。这个脚本的作者逆向了出解密算法，并用Python实现出解密工具，做成了Blender的插件，虽然都是很古老的版本，但要什么自行车，能用就行</p>
<p>那么就利用空余时间，简单记下折腾过程</p>
<h2>2021-6-30 更新</h2><p>注意sketchfab目前对所有模型文件做了二次加密，格式为<code>binz</code>，解密后的格式仍为<code>.bin.gz</code><br>解密关键逻辑在请求模型文件完成后立即执行，懂一点前端调试知识的可以打断点dump出来，暂无自动化处理方法</p>
<h4>附上手动操作步骤：</h4><p>找到类似下图的代码，在附近断点<br>刷新可以看到在断点处停下来了，此时的局部变量<code>i</code>可以看到是一个JSON字符串<br><img src="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@master/imgs/sketchfab_dump.5x0e4ve2o5g0.png" alt="sketchfab_dump"></p>
<p>控制台执行<code>copy(i)</code>可以复制出来，内容类似下面，这个就是之前的<code>file.osgjs</code>文件<br><img src="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@master/imgs/sketchfab_dump.2r2rxt7r5yo0.png" alt="sketchfab_dump"></p>
<p>继续代码执行，可以看到又断下来了，此时的<code>i</code>是一个<code>ArrayBuffer</code>类型的数据<br>执行下图代码保存为文件<br><img src="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@master/imgs/sketchfab_dump.2heperel4os0.png" alt="sketchfab_dump"></p>
<p>对比下看看，这个就是之前的<code>model_file.bin.gz</code><br><img src="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@master/imgs/sketchfab_dump.2s2bksbjqpy0.png" alt="sketchfab_dump"></p>
<p>之后就和以前的步骤一样了</p>
<h4>保存<code>ArrayBuffer</code>到文件</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">var</span> downloadBlob<span class="token punctuation">,</span> downloadURL<span class="token punctuation">;</span>

downloadBlob <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> mimeType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> blob<span class="token punctuation">,</span> url<span class="token punctuation">;</span>
  blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> mimeType
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  url <span class="token operator">=</span> window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">downloadURL</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

downloadURL <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a<span class="token punctuation">;</span>
  a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span>href <span class="token operator">=</span> data<span class="token punctuation">;</span>
  a<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">'display: none'</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">downloadBlob</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">'dump.bin'</span><span class="token punctuation">,</span> <span class="token string">'application/octet-stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2>提取</h2><h3>所需工具</h3><ul>
<li>Python 2.6.6</li>
<li>Blender 2.49</li>
<li><strong><a href="https://cdn.imjad.cn/usr/uploads/Blender249[osgjs].zip" target="_blank" rel="noopener">Blender249[osgjs].zip</a></strong> 解密脚本</li>
</ul>
<h3>工具准备</h3><ol>
<li>安装Python环境 (以下方法二选一，推荐a方法，可移动使用且不影响其他Python版本)<ul>
<li>a.下载Python 2.6.6源码包，将其中的<strong>Lib</strong>目录中的内容压缩为<strong>python26.zip</strong>并放置于Blender安装目录</li>
<li>b.执行安装程序并添加环境变量<code>PythonPath</code>，值为<code>C:\Python26;C:\Python26\DLLs;C:\Python26\Lib;C:\Python26\Lib\lib-tk</code>（假设安装目录为<code>C:\Python26</code>）</li>
</ul>
</li>
<li>安装Blender 2.49</li>
<li>将<strong>Blender249[osgjs].zip</strong>中的<strong>newGameLib</strong>目录解压至Blender安装目录中的<code>.blender\scripts</code>目录下</li>
<li><strong>Blender249.blend</strong>单独放置</li>
</ol>
<h3>下载模型数据</h3><ol>
<li>打开浏览器并打开Dev Tools</li>
<li>打开所需模型的Sketchfab页面，确保模型已经完全加载</li>
<li>在Network选项卡中找到如下两个文件并下载下来放到一起<ul>
<li><strong>file.osgjs.gz</strong></li>
<li><strong>model_file.bin.gz</strong></li>
</ul>
</li>
<li>其中<strong>file.osgjs.gz</strong>是一个JSON文件，将其重命名为<strong>file.osgjs</strong></li>
<li>贴图资源在<code>media.sketchfab.com</code>下，有不同分辨率之分，注意鉴别</li>
<li>也可以忽略以上步骤，直接从网页包含的数据中提取，具体可参考下列代码：</li>
</ol>
<h4>模型数据下载脚本</h4><p>为了快速下载模型数据，我写了一个简单的下载脚本：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> re
<span class="token keyword">import</span> json
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
<span class="token keyword">from</span> html <span class="token keyword">import</span> unescape
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

SCRIPT_VERSION <span class="token operator">=</span> <span class="token string">'1.0'</span>

HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.25 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token string">'accept-encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
    <span class="token string">'accept-language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh-TW;q=0.8,zh;q=0.6,en;q=0.4,ja;q=0.2'</span><span class="token punctuation">,</span>
    <span class="token string">'cache-control'</span><span class="token punctuation">:</span> <span class="token string">'max-age=0'</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    modelId <span class="token operator">=</span> input<span class="token punctuation">(</span><span class="token string">'input model ID (e.g., 9120703a4aee4c2cb0313a9ca3e1e1a3): '</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> <span class="token string">'https://sketchfab.com/models/{id}/embed'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>id<span class="token operator">=</span>modelId<span class="token punctuation">)</span>
    parse<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Parsing...'</span><span class="token punctuation">)</span>
        page <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>HEADERS<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>page<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>

        modelId <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        data <span class="token operator">=</span> unescape<span class="token punctuation">(</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">'js-dom-data-prefetched-data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>string<span class="token punctuation">)</span>
        data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        name <span class="token operator">=</span> validateTitle<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'/i/models/'</span><span class="token operator">+</span>modelId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        thumbnailData <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'/i/models/'</span><span class="token operator">+</span>modelId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'thumbnails'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span>
        thumbnail <span class="token operator">=</span> getBiggestImage<span class="token punctuation">(</span>thumbnailData<span class="token punctuation">)</span>
        osgjsUrl <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'/i/models/'</span><span class="token operator">+</span>modelId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'files'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'osgjsUrl'</span><span class="token punctuation">]</span>
        modelFile <span class="token operator">=</span> osgjsUrl<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'file.osgjs.gz'</span><span class="token punctuation">,</span> <span class="token string">'model_file.bin.gz'</span><span class="token punctuation">)</span>
        texturesData <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'/i/models/'</span><span class="token operator">+</span>modelId<span class="token operator">+</span><span class="token string">'/textures?optimized=1'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'results'</span><span class="token punctuation">]</span>
        textures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Model Id:'</span><span class="token punctuation">,</span> modelId<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Name:'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Thumbnail URL:'</span><span class="token punctuation">,</span>thumbnail<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'osgjs URL:'</span><span class="token punctuation">,</span> osgjsUrl<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Model File:'</span><span class="token punctuation">,</span> modelFile<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Textures:'</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>texturesData<span class="token punctuation">)</span><span class="token punctuation">)</span>

        download<span class="token punctuation">(</span>thumbnail<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'thumbnail.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        download<span class="token punctuation">(</span>osgjsUrl<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'file.osgjs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        download<span class="token punctuation">(</span>modelFile<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'model_file.bin.gz'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> texture <span class="token keyword">in</span> texturesData<span class="token punctuation">:</span>
            textureUrl <span class="token operator">=</span> getBiggestImage<span class="token punctuation">(</span>texture<span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            download<span class="token punctuation">(</span>textureUrl<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'texture'</span><span class="token punctuation">,</span> validateTitle<span class="token punctuation">(</span>texture<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
        <span class="token keyword">raise</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">getBiggestImage</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">:</span>
    size <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> img <span class="token keyword">in</span> images<span class="token punctuation">:</span>
        <span class="token keyword">if</span> img<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> None <span class="token operator">and</span> img<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token operator">></span> size<span class="token punctuation">:</span>
            size <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span>
            imgUrl <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> imgUrl

<span class="token keyword">def</span> <span class="token function">validateTitle</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pattern <span class="token operator">=</span> r<span class="token string">'[\\/:*?"&lt;>|\r\n]+'</span>
    newTitle <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span>
    <span class="token keyword">return</span> newTitle

<span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Downloading:'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'file exists.'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file<span class="token punctuation">:</span>
                    file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>HEADERS<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file<span class="token punctuation">:</span>
                file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>HEADERS<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3>提取过程</h3><ol>
<li>启动Blender，将随之启动一个CMD窗口，可观察有无报错</li>
<li>点击<strong>File</strong> - <strong>Open</strong>，打开<code>Blender249.blend</code>，然后按<kbd>Ctrl</kbd> + <kbd>U</kbd>，这样以后就不用重复此步了</li>
<li>右键点击窗口左侧的Python代码区域，然后点击<strong>Execute Script</strong>或按<kbd>Alt</kbd> + <kbd>P</kbd></li>
<li>在出现的文件选择对话框中导入此前下载的<code>file.osgjs</code></li>
<li>如果一切正常，CMD窗口将刷过大量解密操作相关信息，并在视图中显示解密后的模型</li>
<li>点击<strong>File</strong> - <strong>Export</strong>，将解密后的模型文件导出为其他格式</li>
<li>贴图和动画数据不会被保存，导出的模型可以在任何3D制作软件中进行编辑</li>
</ol>
<p><img src="https://img.imjad.cn/images/2018/11/20/sp181117_203901.png" alt="Blender里的智乃"></p>
<h4>可能遇到的错误</h4><h5>提示<code>IndexError: list index out of range</code>，完整报错类似如下：</h5><pre class="line-numbers language-shell"><code class="language-shell">Traceback (most recent call last):
  File "starter.py", line 1767, in openFile
  File "starter.py", line 1760, in Parser
  File "starter.py", line 1723, in osgParser
  File "C:\blender-2.49-win64\.blender\scripts\newGameLib\myLibraries\meshLib.py", line 670, in draw
  File "C:\blender-2.49-win64\.blender\scripts\newGameLib\myLibraries\meshLib.py", line 588, in addFaces
  File "C:\blender-2.49-win64\.blender\scripts\newGameLib\myLibraries\meshLib.py", line 822, in indicesToTriangleStrips
IndexError: list index out of range<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解决方法：blender左侧的Python代码注释掉<code>330-351</code>行</p>
<h2>看图</h2><p><img src="https://img.imjad.cn/images/2018/11/20/sp181117_214136.png" alt="没穿衣服的智乃"></p>
<p><img src="https://img.imjad.cn/images/2018/11/20/sp181117_214107.png" alt="加上贴图的智乃"></p>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    

    <script>
        var pub_date = 1542700320000;
    </script>
</div>
    <div class="footer"
     id="footer">
    <p>
        Copyright © 2020 <a class="flink"
           href="https://nocilol.me">恶魔萝莉控</a> · Theme by <a class="flink"
           href="https://github.com/journey-ad/hexo-theme-geek">Geek</a>.
        <br>
        Made with <i class="fa fa-heart throb"
           style="color:#d43f57"></i> by <span class="author"
              itemprop="copyrightHolder">journey.ad</span>.
        <label class="el-switch el-switch-green el-switch-sm"
               style="vertical-align: sub;">
            <input type="checkbox"
                   name="switch"
                   id="update_style">
            <span class="el-switch-style"></span>
        </label>
    </p>
</div>

<a href="javascript:void(0);" class="back-to-top" target="_self"></a>

<input type="hidden"
       id="web_style"
       value="white">
<input type="hidden"
       id="valine_appid"
       value="CaQKuPQDfnfPFUkTw6MMt8ME-gzGzoHsz">
<input type="hidden"
       id="valine_appKey"
       value="uWuwGS1xiIwh3zHKENc7ubyL">
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>

  
<script src="/libs/jquery.min.js"></script>

  
<script src="/libs/highlight/highlight.pack.js"></script>

  
<script src="/js/js.js"></script>


<style type="text/css">
    .v * {
        /* color: #698fca; */
    }

    .v .vlist .vcard .vhead .vsys {
        color: #3a3e4a;
    }

    .v .vlist .vcard .vh .vmeta .vat {
        color: #638fd5;
    }

    .v .vlist .vcard .vhead .vnick {
        color: #6ba1ff;
    }

    .v a {
        color: #8696b1;
    }

    .v .vlist .vcard .vhead .vnick:hover {
        color: #669bfc;
    }

    .v .vcards .vcard .vhead .vnick {
        padding-left: 1px;
    }

    .v .vcontent .vemoji {
        max-width: 30px;
    }

    .v[data-class=v] p {
        color: inherit;
    }

</style>

<!-- Load TweenLite -->
<script src="https://cdn.jsdelivr.net/npm/greensock@1.20.2/dist/TweenLite.js"></script>

<!-- Copyrighted cubism SDK -->
<script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
<!-- Load Pixi (dependency for cubism 2/4 integrated loader) -->
<script src="https://cdn.jsdelivr.net/npm/pixi.js@5.3.6/dist/pixi.min.js"></script>
<!-- Load cubism 4 integrated loader -->
<script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.3.1/dist/cubism4.min.js"></script>

<!-- Load pio and alternative loader -->
<link href="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@76ba2b3/live2d/lib/pio.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@76ba2b3/live2d/lib/pio.js"></script>
<script src="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@76ba2b3/live2d/lib/pio_sdk4.js"></script>
<script src="https://cdn.jsdelivr.net/gh/journey-ad/blog-img@76ba2b3/live2d/lib/load.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-71903189-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-71903189-1');
</script>

</body>

</html>